<!-- Author: justin.d.fischer@icloud.com -->
<!-- Web page for Filler Queue -->

{{define "title"}}Filler Queue{{end}}

{{define "body"}}
<link rel="stylesheet" href="/static/css/filler_queue.css">

<!-- Info Card -->
<div class="card rounded-3 shadow-sm mx-auto" style="max-width: 813px;">
  <div class="freezy-card-header bg-header rounded-top">
    <h4 class="mb-0">Practice Match Filler Queue Manager</h4>
  </div>
  <div class="card-body">
    <p>
      Use this panel to add practice matches ad-hoc or build a custom schedule from scratch.
      Matches are automatically spaced 15 minutes apart. If no existing schedule is found,
      the first match is scheduled 15 minutes from the time it’s added.
      You can also edit and re-schedule matches — just make sure to <strong>verify the time</strong> before saving.
    </p>
  </div>
</div>
<br>

<!-- Layout: Match List + Add Match -->
<div class="d-flex flex-row gap-4 align-start flex-wrap">
  <!-- Match Schedule Table -->
  <div class="card rounded-3 shadow-sm flex-fill" style="min-width: 500px;">
    <div class="freezy-card-header bg-schedule rounded-top">
      <h4 class="mb-0">Practice Match Schedule</h4>
    </div>
    <div class="card-body p-3">
      <table class="table table-sm table-striped table-hover rounded-2 overflow-hidden">
        <thead class="table-dark">
          <tr>
            <th>Match</th>
            <th>Time</th>
            <th>Red Alliance</th>
            <th>Blue Alliance</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{range .Matches}}
          <tr>
            <td>{{.ShortName}}</td>
            <td>{{.Time.Format "15:04"}}</td>
            <td class="text-danger fw-bold">{{.Red1}}, {{.Red2}}, {{.Red3}}</td>
            <td class="text-primary fw-bold">{{.Blue1}}, {{.Blue2}}, {{.Blue3}}</td>
            <td>
              <button class="btn btn-sm btn-outline-secondary"
                onclick='populateEditModal("{{.Id}}", "{{.Red1}}", "{{.Red2}}", "{{.Red3}}", "{{.Blue1}}", "{{.Blue2}}", "{{.Blue3}}", "{{.ShortName}}")'
                data-bs-toggle="modal" data-bs-target="#editModal">
                Edit
              </button>
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add Match Form -->
  <div class="card rounded-3 shadow-sm flex-fill align-self-start" style="max-width: 500px;">
    <div class="freezy-card-header bg-editorpane rounded-top">
      <h4 class="mb-0">Add Practice Match</h4>
    </div>
    <div class="card-body">
      <form method="POST" action="/panel/freezy/add_practice_match">
        <fieldset class="mb-3">
          <legend class="h6">Red Alliance</legend>
          {{range $i, $label := (seq 3)}}
          <div class="mb-2">
            <label for="red{{$label}}">Red {{$label}}:</label>
            <input type="number" id="red{{$label}}" name="red{{$label}}" class="form-control rounded-2" required>
          </div>
          {{end}}
        </fieldset>

        <fieldset class="mb-3">
          <legend class="h6">Blue Alliance</legend>
          {{range $i, $label := (seq 3)}}
          <div class="mb-2">
            <label for="blue{{$label}}">Blue {{$label}}:</label>
            <input type="number" id="blue{{$label}}" name="blue{{$label}}" class="form-control rounded-2" required>
          </div>
          {{end}}
        </fieldset>

        <button type="submit" class="btn btn-success w-100 rounded-pill">Add Match</button>
      </form>
    </div>
  </div>
</div>

<!-- Edit Match Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form method="POST" action="/panel/freezy/edit_practice_match" class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">Edit Practice Match: <span id="editMatchLabel"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="matchId" id="editMatchId">
        <div class="mb-3">
          <label for="matchTime">Match Time:</label>
          <input type="time" id="matchTime" name="matchTime" class="form-control" value="{{ .MatchTimeValue }}">
        </div>
        <hr>
        <fieldset class="mb-3">
          <legend class="h6">Red Alliance</legend>
          {{range $i, $label := (seq 3)}}
          <div class="mb-2">
            <label for="editRed{{$label}}">Red {{$label}}:</label>
            <input type="number" id="editRed{{$label}}" name="red{{$label}}" class="form-control rounded-2" required>
          </div>
          {{end}}
        </fieldset>
        <hr>
        <fieldset class="mb-3">
          <legend class="h6">Blue Alliance</legend>
          {{range $i, $label := (seq 3)}}
          <div class="mb-2">
            <label for="editBlue{{$label}}">Blue {{$label}}:</label>
            <input type="number" id="editBlue{{$label}}" name="blue{{$label}}" class="form-control rounded-2" required>
          </div>
          {{end}}
        </fieldset>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary rounded-pill">Save Changes</button>
        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>
{{end}}

{{define "script"}}
<script src="/static/js/add_practice_match.js"></script>
{{end}}
